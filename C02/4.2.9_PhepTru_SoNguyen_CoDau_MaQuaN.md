# 4.2.9 PHÉP TRỪ SỐ NGUYÊN CÓ DẤU BẰNG MÃ QUÁ N

## Mô tả dạng bài tập
Thực hiện phép trừ giữa hai số nguyên có dấu biểu diễn bằng mã quá N và xử lý tràn số (overflow).

## Phương pháp giải

### Phương pháp 1: Trừ trực tiếp
1. **Trừ hai số** như bình thường
2. **Kiểm tra tràn số** (overflow)
3. **Xử lý kết quả** theo yêu cầu

### Phương pháp 2: Xử lý tràn số
1. **Tràn số**: kết quả > 2^(n-1) - 1 hoặc < -2^(n-1)
2. **Kết quả thực tế**: kết quả mod 2^n
3. **Borrow flag**: bit mượn (nếu có)

## Bảng tràn số mã quá N:
| Số bit | Phạm vi | Tràn khi |
|--------|---------|----------|
| 4      | -8 đến 7 | > 7 hoặc < -8 |
| 8      | -128 đến 127 | > 127 hoặc < -128 |
| 16     | -32768 đến 32767 | > 32767 hoặc < -32768 |
| 32     | -2147483648 đến 2147483647 | > 2147483647 hoặc < -2147483648 |

---

## BÀI TẬP CÓ LỜI GIẢI CHI TIẾT (10 bài)

### Bài 1: Trừ 5 - 3 bằng mã quá 8 trong 4 bit

**Lời giải:**
```
  1101₂ (5₁₀ + 8 = 13₁₀)
- 1011₂ (3₁₀ + 8 = 11₁₀)
-------
  0010₂ (2₁₀)

Kiểm tra tràn:
5 - 3 = 2 ≤ 7 (2^(4-1) - 1) ✓
Không tràn số

Kết quả: 5 - 3 = 2 (4 bit mã quá 8)
```

### Bài 2: Trừ 3 - 5 bằng mã quá 8 trong 4 bit

**Lời giải:**
```
  1011₂ (3₁₀ + 8 = 11₁₀)
- 1101₂ (5₁₀ + 8 = 13₁₀)
-------
  1110₂ (-2₁₀)

Kiểm tra tràn:
3 - 5 = -2 ≥ -8 (2^(4-1)) ✓
Không tràn số

Kết quả: 3 - 5 = -2 (4 bit mã quá 8)
```

### Bài 3: Trừ 7 - 1 bằng mã quá 8 trong 4 bit

**Lời giải:**
```
  1111₂ (7₁₀ + 8 = 15₁₀)
- 1001₂ (1₁₀ + 8 = 9₁₀)
-------
  0110₂ (6₁₀)

Kiểm tra tràn:
7 - 1 = 6 ≤ 7 (2^(4-1) - 1) ✓
Không tràn số

Kết quả: 7 - 1 = 6 (4 bit mã quá 8)
```

### Bài 4: Trừ 7 - (-1) bằng mã quá 8 trong 4 bit

**Lời giải:**
```
  1111₂ (7₁₀ + 8 = 15₁₀)
- 0111₂ (-1₁₀ + 8 = 7₁₀)
-------
 10000₂ (8₁₀)

Kiểm tra tràn:
7 - (-1) = 8 > 7 (2^(4-1) - 1) ✗
Có tràn số

Kết quả thực tế: 8 mod 16 = 8
Kết quả: 7 - (-1) = 8 (4 bit mã quá 8, có tràn)
```

### Bài 5: Trừ 100 - 50 bằng mã quá 128 trong 8 bit

**Lời giải:**
```
  10011001₂ (100₁₀ + 128 = 228₁₀)
- 10110010₂ (50₁₀ + 128 = 178₁₀)
-------
  00110010₂ (50₁₀)

Kiểm tra tràn:
100 - 50 = 50 ≤ 127 (2^(8-1) - 1) ✓
Không tràn số

Kết quả: 100 - 50 = 50 (8 bit mã quá 128)
```

### Bài 6: Trừ 50 - 100 bằng mã quá 128 trong 8 bit

**Lời giải:**
```
  10110010₂ (50₁₀ + 128 = 178₁₀)
- 10011001₂ (100₁₀ + 128 = 228₁₀)
-------
  11001101₂ (-50₁₀)

Kiểm tra tràn:
50 - 100 = -50 ≥ -128 (2^(8-1)) ✓
Không tràn số

Kết quả: 50 - 100 = -50 (8 bit mã quá 128)
```

### Bài 7: Trừ 127 - 1 bằng mã quá 128 trong 8 bit

**Lời giải:**
```
  11111111₂ (127₁₀ + 128 = 255₁₀)
- 10000001₂ (1₁₀ + 128 = 129₁₀)
-------
  01111110₂ (126₁₀)

Kiểm tra tràn:
127 - 1 = 126 ≤ 127 (2^(8-1) - 1) ✓
Không tràn số

Kết quả: 127 - 1 = 126 (8 bit mã quá 128)
```

### Bài 8: Trừ 127 - (-1) bằng mã quá 128 trong 8 bit

**Lời giải:**
```
  11111111₂ (127₁₀ + 128 = 255₁₀)
- 01111111₂ (-1₁₀ + 128 = 127₁₀)
-------
 100000000₂ (128₁₀)

Kiểm tra tràn:
127 - (-1) = 128 > 127 (2^(8-1) - 1) ✗
Có tràn số

Kết quả thực tế: 128 mod 256 = 128
Kết quả: 127 - (-1) = 128 (8 bit mã quá 128, có tràn)
```

### Bài 9: Trừ 1000 - 500 bằng mã quá 32768 trong 16 bit

**Lời giải:**
```
  1000001111101000₂ (1000₁₀ + 32768 = 33768₁₀)
- 1000000111110100₂ (500₁₀ + 32768 = 33268₁₀)
-------
  0000000111110100₂ (500₁₀)

Kiểm tra tràn:
1000 - 500 = 500 ≤ 32767 (2^(16-1) - 1) ✓
Không tràn số

Kết quả: 1000 - 500 = 500 (16 bit mã quá 32768)
```

### Bài 10: Trừ 500 - 1000 bằng mã quá 32768 trong 16 bit

**Lời giải:**
```
  1000000111110100₂ (500₁₀ + 32768 = 33268₁₀)
- 1000001111101000₂ (1000₁₀ + 32768 = 33768₁₀)
-------
  1111111000001100₂ (-500₁₀)

Kiểm tra tràn:
500 - 1000 = -500 ≥ -32768 (2^(16-1)) ✓
Không tràn số

Kết quả: 500 - 1000 = -500 (16 bit mã quá 32768)
```

---

## BÀI TẬP TỰ RÈN LUYỆN (20 bài)

### Cấp độ cơ bản (1-10):
1. Trừ 2 - 1 bằng mã quá 8 trong 4 bit
2. Trừ 4 - 2 bằng mã quá 8 trong 4 bit
3. Trừ 6 - 3 bằng mã quá 8 trong 4 bit
4. Trừ 7 - 4 bằng mã quá 8 trong 4 bit
5. Trừ 0 - 0 bằng mã quá 8 trong 4 bit
6. Trừ 50 - 20 bằng mã quá 128 trong 8 bit
7. Trừ 100 - 30 bằng mã quá 128 trong 8 bit
8. Trừ 120 - 40 bằng mã quá 128 trong 8 bit
9. Trừ 127 - 50 bằng mã quá 128 trong 8 bit
10. Trừ 0 - 0 bằng mã quá 128 trong 8 bit

### Cấp độ trung bình (11-15):
11. Trừ 1000 - 200 bằng mã quá 32768 trong 16 bit
12. Trừ 5000 - 1000 bằng mã quá 32768 trong 16 bit
13. Trừ 10000 - 2000 bằng mã quá 32768 trong 16 bit
14. Trừ 20000 - 5000 bằng mã quá 32768 trong 16 bit
15. Trừ 32767 - 10000 bằng mã quá 32768 trong 16 bit

### Cấp độ nâng cao (16-20):
16. Trừ 1000000 - 200000 bằng mã quá 2147483648 trong 32 bit
17. Trừ 5000000 - 1000000 bằng mã quá 2147483648 trong 32 bit
18. Trừ 10000000 - 2000000 bằng mã quá 2147483648 trong 32 bit
19. Trừ 20000000 - 5000000 bằng mã quá 2147483648 trong 32 bit
20. Trừ 2147483647 - 10000000 bằng mã quá 2147483648 trong 32 bit

---

##  MẸO VÀ LƯU Ý

### MẸO LÀM NHANH:
- **Trừ như bình thường** trước
- **Kiểm tra tràn số** sau
- **Xử lý kết quả** theo yêu cầu
- **Nhớ công thức** tràn: kết quả > 2^(n-1) - 1 hoặc < -2^(n-1)

### LƯU Ý QUAN TRỌNG:
- **Tràn số** không phải lỗi, mà là đặc tính
- **Kết quả thực tế** = kết quả mod 2^n
- **Borrow flag** = bit mượn (nếu có)
- **Kiểm tra** tràn trước khi sử dụng

### CÁCH KIỂM TRA:
- **Tính toán** kết quả trước
- **So sánh** với phạm vi bit
- **Xử lý** tràn nếu cần
- **Kiểm tra** bằng máy tính

### CÁC TRƯỜNG HỢP ĐẶC BIỆT:
- **A - 0 = A** (trừ 0)
- **A - A = 0** (trừ chính nó)
- **0 - A = -A** (0 trừ số dương)

### PHƯƠNG PHÁP NHANH:
1. **Trừ** hai số
2. **Kiểm tra** tràn số
3. **Xử lý** kết quả
4. **Ghi** kết quả cuối cùng

### VÍ DỤ ỨNG DỤNG:
```cpp
// Phép trừ số nguyên có dấu bằng mã quá N
struct ExcessNSubResult {
    int result;
    bool overflow;
};

ExcessNSubResult excessNSub(int a, int b, int bits) {
    int N = 1 << (bits - 1);
    int maxValue = N - 1;
    int minValue = -N;
    int diff = a - b;
    bool overflow = diff > maxValue || diff < minValue;
    
    if (overflow) {
        diff = diff & ((1 << bits) - 1);
    }
    
    return {diff, overflow};
}

// Kiểm tra tràn số
bool checkOverflow(int a, int b, int bits) {
    int N = 1 << (bits - 1);
    int maxValue = N - 1;
    int minValue = -N;
    int diff = a - b;
    return diff > maxValue || diff < minValue;
}
```

### ỨNG DỤNG THỰC TẾ:
- **Máy tính**: Excess-N arithmetic
- **Assembly**: Excess-N operations
- **Counters**: Loop counters, array indices
- **Memory addressing**: Address calculations
- **Hash functions**: Checksum calculations

---

**Tài liệu tham khảo:**
- Chương 2: Biểu diễn dữ liệu trên máy tính
- Phần 4.2: Biểu diễn số nguyên có dấu bằng mã quá N








