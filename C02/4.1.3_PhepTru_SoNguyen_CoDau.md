# 4.1.3 PHÉP TRỪ SỐ NGUYÊN CÓ DẤU

## Mô tả dạng bài tập
Thực hiện phép trừ giữa hai số nguyên có dấu và xử lý tràn số (overflow).

## Phương pháp giải

### Phương pháp 1: Trừ trực tiếp
1. **Trừ hai số** như bình thường
2. **Kiểm tra tràn số** (overflow)
3. **Xử lý kết quả** theo yêu cầu

### Phương pháp 2: Xử lý tràn số
1. **Tràn số**: kết quả > 2^(n-1) - 1 hoặc < -2^(n-1)
2. **Kết quả thực tế**: kết quả mod 2^n
3. **Borrow flag**: bit mượn (nếu có)

## Bảng tràn số:
| Số bit | Phạm vi | Tràn khi |
|--------|---------|----------|
| 4      | -8 đến 7 | > 7 hoặc < -8 |
| 8      | -128 đến 127 | > 127 hoặc < -128 |
| 16     | -32768 đến 32767 | > 32767 hoặc < -32768 |
| 32     | -2147483648 đến 2147483647 | > 2147483647 hoặc < -2147483648 |

---

## BÀI TẬP CÓ LỜI GIẢI CHI TIẾT (10 bài)

### Bài 1: Trừ 5 - 3 trong 4 bit có dấu

**Lời giải:**
```
  0101₂ (5₁₀)
- 0011₂ (3₁₀)
-------
  0010₂ (2₁₀)

Kiểm tra tràn:
5 - 3 = 2 ≤ 7 (2^(4-1) - 1) ✓
Không tràn số

Kết quả: 5 - 3 = 2 (4 bit có dấu)
```

### Bài 2: Trừ 3 - 5 trong 4 bit có dấu

**Lời giải:**
```
  0011₂ (3₁₀)
- 0101₂ (5₁₀)
-------
  1110₂ (-2₁₀)

Kiểm tra tràn:
3 - 5 = -2 ≥ -8 (2^(4-1)) ✓
Không tràn số

Kết quả: 3 - 5 = -2 (4 bit có dấu)
```

### Bài 3: Trừ 7 - 1 trong 4 bit có dấu

**Lời giải:**
```
  0111₂ (7₁₀)
- 0001₂ (1₁₀)
-------
  0110₂ (6₁₀)

Kiểm tra tràn:
7 - 1 = 6 ≤ 7 (2^(4-1) - 1) ✓
Không tràn số

Kết quả: 7 - 1 = 6 (4 bit có dấu)
```

### Bài 4: Trừ 7 - (-1) trong 4 bit có dấu

**Lời giải:**
```
  0111₂ (7₁₀)
- 1111₂ (-1₁₀)
-------
 10000₂ (8₁₀)

Kiểm tra tràn:
7 - (-1) = 8 > 7 (2^(4-1) - 1) ✗
Có tràn số

Kết quả thực tế: 8 mod 16 = 8
Kết quả: 7 - (-1) = 8 (4 bit có dấu, có tràn)
```

### Bài 5: Trừ 100 - 50 trong 8 bit có dấu

**Lời giải:**
```
  01100100₂ (100₁₀)
- 00110010₂ (50₁₀)
-------
  00110010₂ (50₁₀)

Kiểm tra tràn:
100 - 50 = 50 ≤ 127 (2^(8-1) - 1) ✓
Không tràn số

Kết quả: 100 - 50 = 50 (8 bit có dấu)
```

### Bài 6: Trừ 50 - 100 trong 8 bit có dấu

**Lời giải:**
```
  00110010₂ (50₁₀)
- 01100100₂ (100₁₀)
-------
  11001110₂ (-50₁₀)

Kiểm tra tràn:
50 - 100 = -50 ≥ -128 (2^(8-1)) ✓
Không tràn số

Kết quả: 50 - 100 = -50 (8 bit có dấu)
```

### Bài 7: Trừ 127 - 1 trong 8 bit có dấu

**Lời giải:**
```
  01111111₂ (127₁₀)
- 00000001₂ (1₁₀)
-------
  01111110₂ (126₁₀)

Kiểm tra tràn:
127 - 1 = 126 ≤ 127 (2^(8-1) - 1) ✓
Không tràn số

Kết quả: 127 - 1 = 126 (8 bit có dấu)
```

### Bài 8: Trừ 127 - (-1) trong 8 bit có dấu

**Lời giải:**
```
  01111111₂ (127₁₀)
- 11111111₂ (-1₁₀)
-------
 100000000₂ (128₁₀)

Kiểm tra tràn:
127 - (-1) = 128 > 127 (2^(8-1) - 1) ✗
Có tràn số

Kết quả thực tế: 128 mod 256 = 128
Kết quả: 127 - (-1) = 128 (8 bit có dấu, có tràn)
```

### Bài 9: Trừ 1000 - 500 trong 16 bit có dấu

**Lời giải:**
```
  0000001111101000₂ (1000₁₀)
- 0000000111110100₂ (500₁₀)
-------
  0000000111110100₂ (500₁₀)

Kiểm tra tràn:
1000 - 500 = 500 ≤ 32767 (2^(16-1) - 1) ✓
Không tràn số

Kết quả: 1000 - 500 = 500 (16 bit có dấu)
```

### Bài 10: Trừ 500 - 1000 trong 16 bit có dấu

**Lời giải:**
```
  0000000111110100₂ (500₁₀)
- 0000001111101000₂ (1000₁₀)
-------
  1111111000001100₂ (-500₁₀)

Kiểm tra tràn:
500 - 1000 = -500 ≥ -32768 (2^(16-1)) ✓
Không tràn số

Kết quả: 500 - 1000 = -500 (16 bit có dấu)
```

---

## BÀI TẬP TỰ RÈN LUYỆN (20 bài)

### Cấp độ cơ bản (1-10):
1. Trừ 2 - 1 trong 4 bit có dấu
2. Trừ 4 - 2 trong 4 bit có dấu
3. Trừ 6 - 3 trong 4 bit có dấu
4. Trừ 7 - 4 trong 4 bit có dấu
5. Trừ 0 - 0 trong 4 bit có dấu
6. Trừ 50 - 20 trong 8 bit có dấu
7. Trừ 100 - 30 trong 8 bit có dấu
8. Trừ 120 - 40 trong 8 bit có dấu
9. Trừ 127 - 50 trong 8 bit có dấu
10. Trừ 0 - 0 trong 8 bit có dấu

### Cấp độ trung bình (11-15):
11. Trừ 1000 - 200 trong 16 bit có dấu
12. Trừ 5000 - 1000 trong 16 bit có dấu
13. Trừ 10000 - 2000 trong 16 bit có dấu
14. Trừ 20000 - 5000 trong 16 bit có dấu
15. Trừ 32767 - 10000 trong 16 bit có dấu

### Cấp độ nâng cao (16-20):
16. Trừ 1000000 - 200000 trong 32 bit có dấu
17. Trừ 5000000 - 1000000 trong 32 bit có dấu
18. Trừ 10000000 - 2000000 trong 32 bit có dấu
19. Trừ 20000000 - 5000000 trong 32 bit có dấu
20. Trừ 2147483647 - 10000000 trong 32 bit có dấu

---

##  MẸO VÀ LƯU Ý

### MẸO LÀM NHANH:
- **Trừ như bình thường** trước
- **Kiểm tra tràn số** sau
- **Xử lý kết quả** theo yêu cầu
- **Nhớ công thức** tràn: kết quả > 2^(n-1) - 1 hoặc < -2^(n-1)

### LƯU Ý QUAN TRỌNG:
- **Tràn số** không phải lỗi, mà là đặc tính
- **Kết quả thực tế** = kết quả mod 2^n
- **Borrow flag** = bit mượn (nếu có)
- **Kiểm tra** tràn trước khi sử dụng

### CÁCH KIỂM TRA:
- **Tính toán** kết quả trước
- **So sánh** với phạm vi bit
- **Xử lý** tràn nếu cần
- **Kiểm tra** bằng máy tính

### CÁC TRƯỜNG HỢP ĐẶC BIỆT:
- **A - 0 = A** (trừ 0)
- **A - A = 0** (trừ chính nó)
- **0 - A = -A** (0 trừ số dương)

### PHƯƠNG PHÁP NHANH:
1. **Trừ** hai số
2. **Kiểm tra** tràn số
3. **Xử lý** kết quả
4. **Ghi** kết quả cuối cùng

### VÍ DỤ ỨNG DỤNG:
```cpp
// Phép trừ số nguyên có dấu
struct SignedSubResult {
    int result;
    bool overflow;
};

SignedSubResult signedSub(int a, int b, int bits) {
    int maxValue = (1 << (bits - 1)) - 1;
    int minValue = -(1 << (bits - 1));
    int diff = a - b;
    bool overflow = diff > maxValue || diff < minValue;
    
    if (overflow) {
        diff = diff & ((1 << bits) - 1);
    }
    
    return {diff, overflow};
}

// Kiểm tra tràn số
bool checkOverflow(int a, int b, int bits) {
    int maxValue = (1 << (bits - 1)) - 1;
    int minValue = -(1 << (bits - 1));
    int diff = a - b;
    return diff > maxValue || diff < minValue;
}
```

### ỨNG DỤNG THỰC TẾ:
- **Máy tính**: Signed arithmetic
- **Assembly**: SUB instruction với borrow flag
- **Counters**: Loop counters, array indices
- **Memory addressing**: Address calculations
- **Hash functions**: Checksum calculations

---

**Tài liệu tham khảo:**
- Chương 2: Biểu diễn dữ liệu trên máy tính
- Phần 4.1: Biểu diễn số nguyên có dấu
